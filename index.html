<!DOCTYPE html>
<html>
  <head>
    <!-- Si votre application est servie dans un sous-dossier, assurez-vous que le href est correct -->
    <base href="/easyeconomyWeb/">
    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="description" content="A new Flutter project.">
    
    <!-- iOS meta tags & icônes -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="easyeconomy">
    <link rel="apple-touch-icon" href="icons/Icon-192.png">
    
    <!-- Fichier manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" type="text/css" href="splash/style.css">
    
    <title>easyeconomy</title>
    
    <!-- Styles pour simuler un écran mobile -->
    <style>
      body {
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f5f5f5; /* Couleur de fond */
      }
      #flutter_container {
        width: 375px;  /* Largeur simulée d'un mobile */
        height: 667px; /* Hauteur simulée d'un mobile */
        border: 1px solid #ccc; /* Pour simuler l'appareil (optionnel) */
        border-radius: 20px; /* Coins arrondis */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Ombre esthétique */
        overflow: hidden; /* Le contenu reste dans la boîte */
      }
    </style>
  </head>
  <body>
    <!-- Conteneur simulant un écran mobile -->
    <div id="flutter_container">
      <!-- Code d'installation du service worker et chargement du script principal -->
      <script>
        const serviceWorkerVersion = "2810830315";
        var scriptLoaded = false;
        function loadMainDartJs() {
          if (scriptLoaded) {
            return;
          }
          scriptLoaded = true;
          var scriptTag = document.createElement('script');
          scriptTag.src = 'main.dart.js';
          scriptTag.type = 'application/javascript';
          document.body.append(scriptTag);
        }
    
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', function () {
            var serviceWorkerUrl = 'flutter_service_worker.js?v=' + serviceWorkerVersion;
            navigator.serviceWorker.register(serviceWorkerUrl)
              .then((reg) => {
                function waitForActivation(serviceWorker) {
                  serviceWorker.addEventListener('statechange', () => {
                    if (serviceWorker.state == 'activated') {
                      console.log('Installed new service worker.');
                      loadMainDartJs();
                    }
                  });
                }
                if (!reg.active && (reg.installing || reg.waiting)) {
                  waitForActivation(reg.installing ?? reg.waiting);
                } else if (!reg.active.scriptURL.endsWith(serviceWorkerVersion)) {
                  console.log('New service worker available.');
                  reg.update();
                  waitForActivation(reg.installing);
                } else {
                  console.log('Loading app from service worker.');
                  loadMainDartJs();
                }
              });
    
            // Fallback si le service worker ne charge pas dans un délai raisonnable
            setTimeout(() => {
              if (!scriptLoaded) {
                console.warn('Failed to load app from service worker. Falling back to plain <script> tag.');
                loadMainDartJs();
              }
            }, 4000);
          });
        } else {
          // Si les service workers ne sont pas supportés
          loadMainDartJs();
        }
      </script>
    
      <!-- Splash screen (optionnel) -->
      <picture id="splash">
        <source srcset="splash/img/light-1x.png 1x, splash/img/light-2x.png 2x, splash/img/light-3x.png 3x, splash/img/light-4x.png 4x"
                media="(prefers-color-scheme: light) or (prefers-color-scheme: no-preference)">
        <source srcset="splash/img/dark-1x.png 1x, splash/img/dark-2x.png 2x, splash/img/dark-3x.png 3x, splash/img/dark-4x.png 4x"
                media="(prefers-color-scheme: dark)">
        <img class="center" src="splash/img/light-1x.png" alt="Splash screen" />
      </picture>
    </div>
  </body>
</html>
